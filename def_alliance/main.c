#include "./graph/graph.h"
#include "./focused_crawler/max_flow.h"

int main(void)
{
    // Max Flow Tests
    // START 1
    // Setup
    int64_t k = 4;
    struct graph g_flow;
    g_flow = parse_graph6("E?Fg"); // Catholic cross graph
    struct vertex* v_flow_source = add_vertex(&g_flow);
    struct vertex* v_flow_target = add_vertex(&g_flow);
    add_edge(v_flow_source, get_vertex(&g_flow, 0));
    add_edge(v_flow_source, get_vertex(&g_flow, 1));
    add_edge(v_flow_source, get_vertex(&g_flow, 3));
    add_edge(get_vertex(&g_flow, 2), v_flow_target);
    add_edge(get_vertex(&g_flow, 4), v_flow_target);

    // Execute
    int64_t max_flow = edmonds_karp(&g_flow, v_flow_source, v_flow_target, k);

    // Teardown
    free_vertex_ek_decorators(&g_flow);
    free_edge_ek_decorators(&g_flow);
    delete_graph(&g_flow);
    // END 1

    // START 2
    // Setup
    k = 4;
    g_flow = parse_graph6("~?@V???????????????????????????????????????????????????????????????????????????????????????????????????_???????????@?G????G?????????????????????????????????????????????????_???????A????E??????_???A??????@??PC????A???A??O???A???C?????W???K????G?????_?_O??C??O??K?G??C???c??????c?????????????????????B????_?GA?A?????O???A?????A?@?@????C?????o???OG??O????C??_?_C??????A?O???@_????@?o??A_??C_G?????G?_?C????C???????C?_??I????????qO??B????C??I_??G??o????P_??E?????G?_@??C?????CG?@_GO@G?@?@G??@???G??????A_@oA?G???O??D?A?E?Oo?Q?????@_??o???O?aG???O?F?????O???A?CCG?@??[??B_??H?????????COc?sa??C??????_W@gc???G?@A???p?oC??????o???p_WA?"); // 27015 HoG
    v_flow_source = add_vertex(&g_flow);
    v_flow_target = add_vertex(&g_flow);
    add_edge(v_flow_source, get_vertex(&g_flow, 0));
    add_edge(v_flow_source, get_vertex(&g_flow, 1));
    add_edge(v_flow_source, get_vertex(&g_flow, 3));
    add_edge(get_vertex(&g_flow, 2), v_flow_target);
    add_edge(get_vertex(&g_flow, 31), v_flow_target);
    add_edge(get_vertex(&g_flow, 32), v_flow_target);
    add_edge(get_vertex(&g_flow, 33), v_flow_target);
    add_edge(get_vertex(&g_flow, 34), v_flow_target);
    add_edge(get_vertex(&g_flow, 35), v_flow_target);
    add_edge(get_vertex(&g_flow, 36), v_flow_target);
    add_edge(get_vertex(&g_flow, 37), v_flow_target);
    add_edge(get_vertex(&g_flow, 38), v_flow_target);
    add_edge(get_vertex(&g_flow, 39), v_flow_target);
    add_edge(get_vertex(&g_flow, 40), v_flow_target);

    // Execute
    max_flow = edmonds_karp(&g_flow, v_flow_source, v_flow_target, k);

    // Teardown
    free_vertex_ek_decorators(&g_flow);
    free_edge_ek_decorators(&g_flow);
    delete_graph(&g_flow);
    // END 2
    // End of Max Flow Tests


    // Max Flow Min Cut Tests
    // START 1
    // Setup
    k = 4;
    uint64_t flow_res, cut_res;
    struct graph g_cut;
    g_cut = new_graph(k + 5); // Layers: source, two vertices, one vertex, one vertex, k+1 vertices, target
    struct vertex* v_cut_source = add_vertex(&g_cut);
    struct vertex* v_cut_target = add_vertex(&g_cut);
    add_edge(v_cut_source, get_vertex(&g_cut, 0));
    add_edge(v_cut_source, get_vertex(&g_cut, 1));
    add_edge(get_vertex(&g_cut, 0), get_vertex(&g_cut, 2));
    add_edge(get_vertex(&g_cut, 1), get_vertex(&g_cut, 2));
    add_edge(get_vertex(&g_cut, 2), get_vertex(&g_cut, 3));
    for (uint64_t i = 0; i < k + 1; i++)
    {
        add_edge(get_vertex(&g_cut, 3), get_vertex(&g_cut, 4+i));
        add_edge(get_vertex(&g_cut, 4 + i), v_cut_target);
    }

    // Execute
    flow_res = edmonds_karp(&g_cut, v_cut_source, v_cut_target, k);
    struct vertex** c_list = source_component_min_cut_after_max_flow(&g_cut, v_cut_source, v_cut_target, k, &cut_res); // Cut should happen between one vertex layers

    // Teardown
    free(c_list);
    free_vertex_ek_decorators(&g_cut);
    free_edge_ek_decorators(&g_cut);
    delete_graph(&g_cut);
    // END 1
    // End of Max Flow Min Cut Tests

    struct graph g;
    g = parse_graph6("I?rFUzsjw");
    print_graph(&g);
    g = parse_graph6("~?Br?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????@???????????C???????????@????????????_???????????A????????????C????????????C????????????A?????????????_?????????????????????????????????????????????????????????????????????????????????????????????_?????????????A??????????????C??????????????C??????????????@??????????????@???????????????C???C???????????O???O???????????_???_???????????_???_???????????G???G???????????G???G?????????????A_??????????????AA????????????????c???????????????GC???????????????C@???????????????O@????????????????C??C??????????????O??O_?????????????_??_??????????????_??`??????????????G??O??????????????G??CK??????????????????_?????????????????D??????????????????A??????????????????H???????????????????_?????????????????@C???????????????????O???????????????????_???????????????????_???????????????????G???????????????????G???????????????????_??????????????????_A??????????????????A?C??????????????????C?C??????????????????C?A??????????????????@??_?????????????????@??C????????????????C????O????????????????O????_????????????????_????_????????????????_????O????????????????G????C????????????????G?????_????????????????_????A????????????????A?????C????????????????C?????C????????????????C?????A????????????????@??????_???????????????@??????C????????????????C??????O????????????????O??????_????????????????_??????_????????????????_??????O????????????????G??????C????????????????G???????_???????????????????????A????????????????????????C????????????????????????C????????????????????????A?????????????????????????_????????????????????????C?????????????????????????O?????????????????????????_?????????????????????????_?????????????????????????O?????????????????????????C??????????????????????????_?????????????????_???????A?????????????????@????????C??????????????????_???????C?????????????????A????????@?????????????????O????????@?????????????????A?????????C?????????????????A?????????O?????????????????C?????????_????????????????A??????????_????????????????@??????????O?????????????????O?????????C?????????????????C??????????_????A??????????????????????A????C???????????????????????C????G???????????????????????C????G???????????????????????A????C????????????????????????_????_????????????????????C??C????????????????C?????????O??G????????????????O?????????_??G????????????????_?????????_??G????????????????_?????????O??_????????????????G?????????C?@?????????????????G??????????_??O????????????????_?????????A???_???????????????A??????????C??O????????????????C??????????C??G????????????????C??????????@??@????????????????@??????????@??@????????????????@??????????????CC??????????????????????????????AA?????????????????????????????@@???????????????????????????????GG?????????????????????????????@@???????????????????????????????OO?????????????????????????????_????_??????????????????????????A????A????????????????C??????????C????C???????????????????????????C????C????????????????G??????????A????@????????????????????????????_???@????????????????@?????????C????C????????????????C???????????O????O????????????????O???????????_????_????????????????_???????????_????_????????????????_???????????G????O????????????????G???????????G????C????????????????G???_???????????????????_?????????????A???????????????????A????????????C?C???????????????????C??????????????C???????????????????C????????????G?@???????????????????@??????????????@???????????????????@????????????@??C???????????????????C???????????????O???????????????????O???????????????_???????????????????_???????????????_???????????????????_???????????????G???????????????????G???????????????G???????????????????G????????????????_???????????????????_???????????_???A???????????????????A???????????A????C???????????????????C???????????C????C???????????????????C???????????C????@???????????????????@???????????@????@???????????????????@???????????@?????C???????????????????C????????C??C?????O???????????????????O????????O??O?????_???????????????????_????????_??_?????_???????????????????_????????_??_?????G???????????????????G????????G??G?????G???????????????????G????????G??G??????_???????????????????_??????_?_????????A???????????????????A??????A?A?????????C???????????????????C??????C?C?????????C???????????????????C??????C?C?????????@???????????????????@??????@?@?????????@???????????????????@??????@?@????????????C???????????????????C??C???C????????????O???????????????????O??O???O????????????_???????????????????_??_???_????????????_???????????????????_??_???_????????????G???????????????????G??G???G????????????G???????????????????G??G???G????");
    print_graph(&g);
    return 0;
}
